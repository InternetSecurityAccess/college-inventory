<%- layout('layout') %>

<h2>Отчеты</h2>

<div class="report-menu">
    <h3>Выберите тип отчета и настройте фильтры:</h3>
    <ul>
        <li>
            <h4>По местоположению</h4>
            <form action="/reports/by-location" method="GET">
                <label for="locStartDate">Период с:</label>
                <input type="date" id="locStartDate" name="startDate" value="<%= currentFilters.startDate || '' %>">
                <label for="locEndDate">по:</label>
                <input type="date" id="locEndDate" name="endDate" value="<%= currentFilters.endDate || '' %>">

                <label for="locLocationId">Местоположение:</label>
                <select id="locLocationId" name="locationId" required>
                    <option value="">-- Все местоположения --</option>
                    <% locations.forEach(loc => { %>
                        <option value="<%= loc.id %>" <%= currentFilters.locationId == loc.id ? 'selected' : '' %>><%= loc.name %></option>
                    <% }) %>
                </select>
                <button type="submit">Сформировать</button>
            </form>
            <p><a href="/reports/by-location/export-csv?<%= new URLSearchParams({ startDate: currentFilters.startDate || '', endDate: currentFilters.endDate || '', locationId: currentFilters.locationId || '' }).toString() %>">Экспорт в CSV</a></p>
        </li>
        <li>
            <h4>По виду предмета</h4>
            <form action="/reports/by-item-type" method="GET">
                <label for="typeStartDate">Период с:</label>
                <input type="date" id="typeStartDate" name="startDate" value="<%= currentFilters.startDate || '' %>">
                <label for="typeEndDate">по:</label>
                <input type="date" id="typeEndDate" name="endDate" value="<%= currentFilters.endDate || '' %>">

                <label for="typeItemTypeId">Вид предмета:</label>
                <select id="typeItemTypeId" name="itemTypeId">
                    <option value="">-- Все виды предметов --</option>
                    <% itemTypes.forEach(type => { %>
                        <option value="<%= type.id %>" <%= currentFilters.itemTypeId == type.id ? 'selected' : '' %>><%= type.name %></option>
                    <% }) %>
                </select>
                <button type="submit">Сформировать</button>
            </form>
            <p><a href="/reports/by-item-type/export-csv?<%= new URLSearchParams({ startDate: currentFilters.startDate || '', endDate: currentFilters.endDate || '', itemTypeId: currentFilters.itemTypeId || '' }).toString() %>">Экспорт в CSV</a></p>
        </li>
        <li>
            <h4>По статусу</h4>
            <form action="/reports/by-status" method="GET">
                <label for="statusStartDate">Период с:</label>
                <input type="date" id="statusStartDate" name="startDate" value="<%= currentFilters.startDate || '' %>">
                <label for="statusEndDate">по:</label>
                <input type="date" id="statusEndDate" name="endDate" value="<%= currentFilters.endDate || '' %>">
                <button type="submit">Сформировать</button>
            </form>
            <p><a href="/reports/by-status/export-csv?<%= new URLSearchParams({ startDate: currentFilters.startDate || '', endDate: currentFilters.endDate || '' }).toString() %>">Экспорт в CSV</a></p>
        </li>
        <li>
            <h4>Общий отчет</h4>
            <p>Показывает сводную информацию по всему инвентарю.</p>
            <form action="/reports/overview" method="GET">
                <label for="overviewStartDate">Период с:</label>
                <input type="date" id="overviewStartDate" name="startDate" value="<%= currentFilters.startDate || '' %>">
                <label for="overviewEndDate">по:</label>
                <input type="date" id="overviewEndDate" name="endDate" value="<%= currentFilters.endDate || '' %>">
                <button type="submit">Перейти</button>
            </form>
        </li>
    </ul>
</div>

<script>
    // Обработка сброса для форм отчетов
    document.addEventListener('DOMContentLoaded', function() {
        // Можно добавить обработчик для сброса фильтров здесь, если потребуется

        // Автоматическое обновление при изменении фильтров (для отчетов)
        const reportForms = document.querySelectorAll('.report-menu form');
        reportForms.forEach(form => {
            // Исключаем формы, которые не содержат поля даты или select (например, общий отчет)
            const inputs = form.querySelectorAll('input[type="date"], select');
            if (inputs.length > 0) {
                inputs.forEach(input => {
                    input.addEventListener('change', () => {
                        // Найдем кнопку submit в этой форме и нажмем ее
                        form.querySelector('button[type="submit"]').click();
                    });
                });
            }
        });
    });
</script>