<%- layout('layout') %>

<h2>Отчет по виду предмета</h2>

<!-- Форма фильтрации для отчета -->
<div class="report-filters">
    <h3>Фильтры</h3>
    <form action="/reports/by-item-type" method="GET">
        <label for="startDate">Период с:</label>
        <input type="date" id="startDate" name="startDate" value="<%= currentFilters.startDate || '' %>">

        <label for="endDate">по:</label>
        <input type="date" id="endDate" name="endDate" value="<%= currentFilters.endDate || '' %>">

        <label for="itemTypeId">Вид предмета:</label>
        <select id="itemTypeId" name="itemTypeId">
            <option value="">-- Все виды предметов --</option>
            <% itemTypes.forEach(type => { %>
                <option value="<%= type.id %>" <%= currentFilters.itemTypeId == type.id ? 'selected' : '' %>><%= type.name %></option>
            <% }) %>
        </select>
        <button type="submit">Применить</button>
        <a href="/reports/by-item-type">Сбросить</a>
        <a href="/reports/by-item-type/export-csv?<%= new URLSearchParams({ startDate: currentFilters.startDate || '', endDate: currentFilters.endDate || '', itemTypeId: currentFilters.itemTypeId || '' }).toString() %>">Экспорт в CSV</a>
    </form>
</div>

<% if (!reportData || reportData.length === 0) { %>
    <p>Нет данных для отображения по заданным критериям.</p>
<% } else { %>
    <table>
        <thead>
            <tr>
                <th>Вид предмета</th>
                <th>Всего предметов</th>
                <th>В наличии</th>
                <th>В ремонте</th>
                <th>Списано</th>
                <th>На выдаче</th>
            </tr>
        </thead>
        <tbody>
            <% reportData.forEach(row => { %>
                <tr>
                    <td><%= row.item_type_name %></td>
                    <td><%= row.total_items %></td>
                    <td><%= row.available_items %></td>
                    <td><%= row.repair_items %></td>
                    <td><%= row.written_off_items %></td>
                    <td><%= row.issued_items %></td>
                </tr>
            <% }) %>
        </tbody>
    </table>
<% } %>